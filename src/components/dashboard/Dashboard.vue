<template>
  <v-container class="grey lighten-5">
    <v-row>
      <v-col md="4">
        <v-card class="pa-2" outlined tile>
          <v-card-title> this Month </v-card-title>
          <CategoryPieChart :series="thisMonthSeries" :labels="thisMonthLabels" />
        </v-card>
      </v-col>
      <v-col md="4">
        <v-card class="pa-2" outlined tile>
          <v-card-title> previous Month </v-card-title>
          <CategoryPieChart :series="previousMonthSeries" :labels="previousMonthLabels" />
        </v-card>
      </v-col>
      <v-col md="4">
        <v-card class="pa-2" outlined tile>
          <v-card-title>Incomes and Expenses</v-card-title>
          <IncomesExpensesChart :series="incomesExpensesSeries" :labels="incomesExpensesLabels" />
        </v-card>
      </v-col>
    </v-row>
    <v-row>
       <v-col md="4">
        <v-card class="pa-2" outlined tile>
          <v-card-title>Status</v-card-title>
          <CurrentCurrencies />
        </v-card>
      </v-col>
            <v-col md="4">
        <v-card class="pa-2" outlined tile>
          <v-card-title>Last Days Expenses</v-card-title>
          <CategoriesColumnChart :series="dailyExpensesSeries" />
        </v-card>
      </v-col>
    </v-row>
  </v-container>
</template>

<script>
import CategoryPieChart from "@/components/charts/CategoryPieChart";
import IncomesExpensesChart from "@/components/charts/IncomesExpensesChart";
import CurrentCurrencies from "./CurrentCurrencies"
import CategoriesColumnChart from "@/components/charts/CategoriesColumnChart";

export default {
  name: "Dashboard",
  components: {
    CategoryPieChart,
    IncomesExpensesChart,
    CurrentCurrencies,
    CategoriesColumnChart,
  },
  data: () => ({
    thisMonthSeries: [],
    thisMonthLabels: [],
    previousMonthSeries: [],
    previousMonthLabels: [],
    incomesExpensesSeries: [],
    incomesExpensesLabels: [],
    dailyExpensesSeries:[],
  }),
  created() {
    this.refreshDashboard();
  },
  methods: {
    refreshDashboard: function() {
      this.$store.dispatch("reports/getDashboardData");
    }
  },
  computed: {
    dataSource() {
      return this.$store.state.reports.dashboardData;
    }
  },
  watch: {
    dataSource(newValue) {

      if (newValue.items) {
        this.thisMonthSeries =  this.$store.state.reports.dashboardData.items.thisMonthCategoryChart.map(
          serieValue => (Math.abs(serieValue.value))
        );
        this.thisMonthLabels = this.$store.state.reports.dashboardData.items.thisMonthCategoryChart.map(
          serieValue => (serieValue.category)
        );

        this.previousMonthSeries =  this.$store.state.reports.dashboardData.items.lastMonthCategoryChart.map(
          serieValue => (Math.abs(serieValue.value))
        );
        this.previousMonthLabels = this.$store.state.reports.dashboardData.items.lastMonthCategoryChart.map(
          serieValue => (serieValue.category)
        );
          this.incomesExpensesSeries =
          [
            {
              name: "income",
              data: this.$store.state.reports.dashboardData.items.incomes.map(
                x => (x.value)
              )
            },
            {
              name: "expense",
              data: this.$store.state.reports.dashboardData.items.expenses.map(
                x => (x.value)
              )
            }
          ];
          this.incomesExpensesLabels =  this.$store.state.reports.dashboardData.items.incomes.map(
            x => (new Date(x.from).toLocaleString('default', { month: 'long', year: 'numeric' }))
          );

          this.dailyExpensesSeries = this.$store.state.reports.dashboardData.items.expensesChart.map(
            x => ({name : x.name, data : x.data.map(y => ({x: y.xAxis, y: y.yAxis})) })
          )
      }
    }
  }
};
</script>

<style lang="sass" scoped>

</style>

